import{_ as s,c as a,o as i,R as e}from"./chunks/framework.Tt2DsVC6.js";const m=JSON.parse('{"title":"从 centos docker 上备份 mongodb 数据到本地","description":"","frontmatter":{},"headers":[],"relativePath":"blog/article/2022/2.md","filePath":"blog/article/2022/2.md","lastUpdated":1702369387000}'),o={name:"blog/article/2022/2.md"},t=e('<h1 id="从-centos-docker-上备份-mongodb-数据到本地" tabindex="-1">从 centos docker 上备份 mongodb 数据到本地 <a class="header-anchor" href="#从-centos-docker-上备份-mongodb-数据到本地" aria-label="Permalink to &quot;从 centos docker 上备份 mongodb 数据到本地&quot;">​</a></h1><div class="info custom-block"><p class="custom-block-title">初衷</p><p>项目本意是为了给 centos 上的数据备份到 mac 上的 docker 上。</p></div><h2 id="进入-centos" tabindex="-1">进入 centos <a class="header-anchor" href="#进入-centos" aria-label="Permalink to &quot;进入 centos&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root@139.9.212.113</span></span></code></pre></div><h2 id="进入-docker-中的-mongodb" tabindex="-1">进入 docker 中的 mongodb <a class="header-anchor" href="#进入-docker-中的-mongodb" aria-label="Permalink to &quot;进入 docker 中的 mongodb&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mongodb_container_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/bash</span></span></code></pre></div><h2 id="导出-mongodb-数据到-mongodb-容器内" tabindex="-1">导出 mongodb 数据到 mongodb 容器内 <a class="header-anchor" href="#导出-mongodb-数据到-mongodb-容器内" aria-label="Permalink to &quot;导出 mongodb 数据到 mongodb 容器内&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mongodump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.0.1:27017</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --archive=/home/db.gz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --gzip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d=db</span></span></code></pre></div><ul><li>-h 表示 host</li><li>-d 表示 database</li><li>--gzip 表示压缩</li></ul><p>更多备份内容：<a href="https://docs.mongodb.com/manual/reference/program/mongodump/" target="_blank" rel="noreferrer">https://docs.mongodb.com/manual/reference/program/mongodump/</a></p><h2 id="将上面导出到-mongodb-中的数据拷贝到-centos" tabindex="-1">将上面导出到 mongodb 中的数据拷贝到 centos <a class="header-anchor" href="#将上面导出到-mongodb-中的数据拷贝到-centos" aria-label="Permalink to &quot;将上面导出到 mongodb 中的数据拷贝到 centos&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mongodb_container_id:/home/db.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home</span></span></code></pre></div><ul><li>mongodb_container_id：mongodb 容器 id</li><li>/home/db.gz：mongodb 容器内备份的路径</li><li>/home：导出到 centos 的路径</li></ul><h2 id="本地电脑下载-centos-上备份的-mongodb-数据" tabindex="-1">本地电脑下载 centos 上备份的 mongodb 数据 <a class="header-anchor" href="#本地电脑下载-centos-上备份的-mongodb-数据" aria-label="Permalink to &quot;本地电脑下载 centos 上备份的 mongodb 数据&quot;">​</a></h2><p>在 mac 本地的 zsh 中执行 scp 命令</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root@139.x.xxx.xxx:/home/auto.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/work</span></span></code></pre></div><ul><li><a href="mailto:root@139.x.xxx.xxx" target="_blank" rel="noreferrer">root@139.x.xxx.xxx</a>：表示 centos 登录的账号和 ip</li><li>/home/auto.gz 表示上面导出到 centos 的 mongodb 的数据路径</li><li>~/work 表示导出到本地 mac 的路径</li></ul><h2 id="拷贝上一步导出到本地的-mongodb-数据到-mac中-docker里-mongodb-中" tabindex="-1">拷贝上一步导出到本地的 mongodb 数据到 mac中 docker里 mongodb 中 <a class="header-anchor" href="#拷贝上一步导出到本地的-mongodb-数据到-mac中-docker里-mongodb-中" aria-label="Permalink to &quot;拷贝上一步导出到本地的 mongodb 数据到 mac中 docker里 mongodb 中&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/work/db.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mac_docker_mongodb_container_id:/home/</span></span></code></pre></div><ul><li>~/work/db.gz：表示 mac 中的数据路径</li><li>mac_docker_mongodb_container_id：mac 上 docker mongodb 的 container id</li><li>/home/：表示 mac 上 docker 中 mongodb 容器中备份路径</li></ul><h2 id="导入到本地-mac-的-docker-的-mongodb-中" tabindex="-1">导入到本地 mac 的 docker 的 mongodb 中 <a class="header-anchor" href="#导入到本地-mac-的-docker-的-mongodb-中" aria-label="Permalink to &quot;导入到本地 mac 的 docker 的 mongodb 中&quot;">​</a></h2><p>测试下</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mongorestore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --gzip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --archive=/home/db.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dump/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dryRun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verbose</span></span></code></pre></div><ul><li>--dryRun 表示演习一下</li><li>--verbose 显示执行详情</li><li>注：去掉 --dryRun --verbose 才算真的恢复数据</li></ul><p>上面如果测试成功的话，执行：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mongorestore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --gzip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --archive=/home/db.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dump/</span></span></code></pre></div><p>当 mongod 开启权限认证的话，可以尝试</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mongorestore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p=root39816561</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --gzip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --archive=/home/auto.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dump/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verbose</span></span></code></pre></div><ul><li>更多恢复文档：<a href="https://docs.mongodb.com/manual/reference/program/mongorestore/" target="_blank" rel="noreferrer">https://docs.mongodb.com/manual/reference/program/mongorestore/</a></li><li>参考文章：<a href="https://share.xiaoshaoye.cn/archives/dockermongodb-dao-ru-dao-chu-shu-ju" target="_blank" rel="noreferrer">https://share.xiaoshaoye.cn/archives/dockermongodb-dao-ru-dao-chu-shu-ju</a></li></ul>',29),n=[t];function h(l,d,r,p,c,k){return i(),a("div",null,n)}const b=s(o,[["render",h]]);export{m as __pageData,b as default};
