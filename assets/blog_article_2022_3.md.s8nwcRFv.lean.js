import{_ as s,c as i,o as a,R as n}from"./chunks/framework.Tt2DsVC6.js";const F=JSON.parse('{"title":"Express+Mongodb åŠ¨æ€æ³¨å…¥ mongodb å¯†ç å®è·µè®°å½•","description":"","frontmatter":{},"headers":[],"relativePath":"blog/article/2022/3.md","filePath":"blog/article/2022/3.md","lastUpdated":1702367258000}'),h={name:"blog/article/2022/3.md"},p=n(`<h1 id="express-mongodb-åŠ¨æ€æ³¨å…¥-mongodb-å¯†ç å®è·µè®°å½•" tabindex="-1">Express+Mongodb åŠ¨æ€æ³¨å…¥ mongodb å¯†ç å®è·µè®°å½• <a class="header-anchor" href="#express-mongodb-åŠ¨æ€æ³¨å…¥-mongodb-å¯†ç å®è·µè®°å½•" aria-label="Permalink to &quot;Express+Mongodb åŠ¨æ€æ³¨å…¥ mongodb å¯†ç å®è·µè®°å½•&quot;">â€‹</a></h1><div class="info custom-block"><p class="custom-block-title">åˆè¡·</p><p>ç®€å•ä»‹ç»ä¸‹å¦‚ä½•åœ¨ <code>express</code> é¡¹ç›®ä¸‹é…åˆ <code>docker-compose</code> åŠ¨æ€æ³¨å…¥ <code>mongodb</code> è´¦å·å¯†ç ï¼Œé¡¹ç›®ç›®å½•åœ¨ä¸‹æ–¹ï¼Œä½†ä¸æ¶‰åŠå…·ä½“é¡¹ç›®å¦‚ä½•è¿è¡Œï¼Œåªä»‹ç»å¦‚ä½•ä½¿ç”¨ã€‚</p></div><h2 id="é¡¹ç›®ç›®å½•" tabindex="-1">é¡¹ç›®ç›®å½• <a class="header-anchor" href="#é¡¹ç›®ç›®å½•" aria-label="Permalink to &quot;é¡¹ç›®ç›®å½•&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>ğŸ“¦backend</span></span>
<span class="line"><span> â”£ ğŸ“‚db</span></span>
<span class="line"><span> â”ƒ â”— ğŸ“œindex.ts</span></span>
<span class="line"><span> â”£ ğŸ“‚interface</span></span>
<span class="line"><span> â”£ ğŸ“‚middleware</span></span>
<span class="line"><span> â”£ ğŸ“‚models</span></span>
<span class="line"><span> â”£ ğŸ“‚routes</span></span>
<span class="line"><span> â”£ ğŸ“‚utils</span></span>
<span class="line"><span> â”£ ğŸ“œ.dockerignore</span></span>
<span class="line"><span> â”£ ğŸ“œ.eslintrc.js</span></span>
<span class="line"><span> â”£ ğŸ“œ.gitignore</span></span>
<span class="line"><span> â”£ ğŸ“œDockerfile </span></span>
<span class="line"><span> â”£ ğŸ“œREADME.md</span></span>
<span class="line"><span> â”£ ğŸ“œapp.ts</span></span>
<span class="line"><span> â”£ ğŸ“œbuild.sh // æ³¨å…¥ mongodb å¯†ç å’Œå•ä¸ªåº“å¯†ç </span></span>
<span class="line"><span> â”£ ğŸ“œdev.env // å¼€å‘ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span> â”£ ğŸ“œdocker-compose.yml // ç”Ÿæˆé¡¹ç›®å’Œ mongodb é•œåƒ</span></span>
<span class="line"><span> â”£ ğŸ“œmongo-init.sh // åˆå§‹åŒ–è´¦å·å¯†ç </span></span>
<span class="line"><span> â”£ ğŸ“œpackage-lock.json </span></span>
<span class="line"><span> â”£ ğŸ“œpackage.json</span></span>
<span class="line"><span> â”£ ğŸ“œprod.env // ç”Ÿäº§ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span> â”— ğŸ“œtsconfig.json</span></span></code></pre></div><h2 id="ç¯å¢ƒæ–‡ä»¶" tabindex="-1">ç¯å¢ƒæ–‡ä»¶ <a class="header-anchor" href="#ç¯å¢ƒæ–‡ä»¶" aria-label="Permalink to &quot;ç¯å¢ƒæ–‡ä»¶&quot;">â€‹</a></h2><h3 id="dev-env" tabindex="-1">dev.env <a class="header-anchor" href="#dev-env" aria-label="Permalink to &quot;dev.env&quot;">â€‹</a></h3><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NODE_ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=dev</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=3981</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># MONGODB_URL=mongodb://localhost:27017/auto-answer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGODB_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=mongodb://mongodb:27017/auto-answer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_INITDB_ROOT_USERNAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=root</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_INITDB_ROOT_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=123456</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_USERNAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=admin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=test123456</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_HOST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=localhost</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=27017</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_INITDB_DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=auto-answer</span></span></code></pre></div><h3 id="prod-env" tabindex="-1">prod.env <a class="header-anchor" href="#prod-env" aria-label="Permalink to &quot;prod.env&quot;">â€‹</a></h3><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NODE_ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=3981</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># MONGODB_URL=mongodb://localhost:27017/auto-answer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGODB_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=mongodb://mongodb:27017/auto-answer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_INITDB_ROOT_USERNAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=root</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_INITDB_ROOT_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=123456</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_USERNAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=admin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=test123456</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_HOST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=mongodb</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=27017</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MONGO_INITDB_DATABASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=auto-answer</span></span></code></pre></div><h2 id="æ„å»ºè¿è¡Œ-compose-è„šæœ¬-build-sh" tabindex="-1">æ„å»ºè¿è¡Œ compose è„šæœ¬ build.sh <a class="header-anchor" href="#æ„å»ºè¿è¡Œ-compose-è„šæœ¬-build-sh" aria-label="Permalink to &quot;æ„å»ºè¿è¡Œ compose è„šæœ¬ build.sh&quot;">â€‹</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Need input with build env(&#39;prod&#39; or &#39;dev&#39;) or MONGO_INITDB_ROOT_PASSWORD or MONGO_PASSWORD!&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  exit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  echo</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> $1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  echo</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> $2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  echo</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> $3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MACHINE_ENV=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_INITDB_ROOT_PASSWORD=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_PASSWORD=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auto-answer-backend-hub</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é€šè¿‡ sh build.sh ä¼ å‚æ•°</span></span></code></pre></div><p>æ„å»º compose åªéœ€è¦è¿è¡Œä¸‹æ–¹å‘½ä»¤å³å¯ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„å‘½ä»¤éœ€è¦åœ¨ <code>dockerfile</code> å’Œ <code>compose</code> æ„å»ºå®Œæˆä¹‹åè¿è¡Œï¼‰</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MACHINE_ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_INITDB_ROOT_PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_PASSWORD</span></span></code></pre></div><p>å°†ä¸Šè¿° <code>MONGO_INITDB_ROOT_PASSWORD</code>ã€<code>MONGO_PASSWORD</code> æ›¿æ¢æˆä½ æ‰€æœ‰éœ€è¦çš„å¯†ç </p><p><code>MACHINE_ENV</code> ä¸ºä¸Šé¢é¡¹ç›®ç›®å½•ä¸­çš„ <code>dev</code> æˆ– <code>prod</code>ï¼Œå¯æ ¹æ®éœ€æ±‚æ›´æ”¹ã€‚</p><h2 id="æ„å»º-dockerfile" tabindex="-1">æ„å»º Dockerfile <a class="header-anchor" href="#æ„å»º-dockerfile" aria-label="Permalink to &quot;æ„å»º Dockerfile&quot;">â€‹</a></h2><div class="language-docker vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> node:16.0.0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maintainer=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;webB1anyaoyao@gmail.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /app</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm install</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ls</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> npm run build</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3981</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;npm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h2 id="æ„å»º-docker-compose-yml" tabindex="-1">æ„å»º docker-compose.yml <a class="header-anchor" href="#æ„å»º-docker-compose-yml" aria-label="Permalink to &quot;æ„å»º docker-compose.yml&quot;">â€‹</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">auto-answer-backend-hub</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">on-failure</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    env_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${MACHINE_ENV}.env</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NODE_ENV=\${MACHINE_ENV}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MONGO_INITDB_ROOT_PASSWORD=\${MONGO_INITDB_ROOT_PASSWORD}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MONGO_PASSWORD=\${MONGO_PASSWORD}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3981:3981&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # volumes:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #   - .:/app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mongodb</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  mongodb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">auto-answer-mongo-hub</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mongo:4.0.8</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    env_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${MACHINE_ENV}.env</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MONGO_INITDB_ROOT_PASSWORD=\${MONGO_INITDB_ROOT_PASSWORD}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MONGO_PASSWORD=\${MONGO_PASSWORD}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">~/data:/data/db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./mongo-init.sh:/docker-entrypoint-initdb.d/mongo-init.sh:ro</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;27017:27017&quot;</span></span></code></pre></div><ul><li><code>env_file</code>ï¼šä¸ºç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œ<code>\${MACHINE_ENV}.env</code> çš„ <code>MACHINE_EN</code> ä¸ºè¿è¡Œ <code>build.sh</code> æ³¨å…¥çš„å˜é‡</li><li><code>environment</code>ï¼š ç¯å¢ƒå˜é‡å¦‚æœå’Œ <code>env_file</code> ç›¸åŒï¼Œå°†ä¼šè¦†ç›– <code>env_file</code> ä¸­å˜é‡ï¼Œä¸Šè¿° <code>docker-compose.yml</code> ä¸­é€šè¿‡è¿è¡Œ <code>build.sh</code> æ³¨å…¥çš„å˜é‡è¦†ç›–äº† <code>MONGO_INITDB_ROOT_PASSWORD</code> å’Œ <code>MONGO_PASSWORD</code> å¯ä»¥è®©æ•°æ®åº“å¯†ç å˜æˆåŠ¨æ€çš„</li></ul><h2 id="mongo-init-sh-ç”Ÿæˆ-mongodb-è„šæœ¬" tabindex="-1"><code>mongo-init.sh</code> ç”Ÿæˆ mongodb è„šæœ¬ <a class="header-anchor" href="#mongo-init-sh-ç”Ÿæˆ-mongodb-è„šæœ¬" aria-label="Permalink to &quot;\`mongo-init.sh\` ç”Ÿæˆ mongodb è„šæœ¬&quot;">â€‹</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mongo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MONGO_INITDB_DATABASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  db.createUser({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    user: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MONGO_USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pwd: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MONGO_PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    roles: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      { role: &quot;readWrite&quot;, db: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MONGO_INITDB_DATABASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  })</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></div><h2 id="æ•°æ®è¿æ¥" tabindex="-1">æ•°æ®è¿æ¥ <a class="header-anchor" href="#æ•°æ®è¿æ¥" aria-label="Permalink to &quot;æ•°æ®è¿æ¥&quot;">â€‹</a></h2><p>æ–‡ä»¶ä½ç½®<code>./db/index.ts</code></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mongoose </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;mongoose&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  MONGO_USERNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;admin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  MONGO_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;test123456&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  MONGO_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;localhost&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  MONGO_PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;27017&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  MONGO_INITDB_DATABASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;auto-answer&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> process.env</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uri </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é€šè¿‡ç¯å¢ƒå˜é‡åˆ¤æ–­ï¼Œåˆ‡æ¢è¿æ¥ mongodb çš„ uri</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;dev&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  uri </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`mongodb://\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MONGO_HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MONGO_PORT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MONGO_INITDB_DATABASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  uri </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`mongodb://\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MONGO_USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:\${</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">encodeURIComponent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MONGO_PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}@\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MONGO_HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}:\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MONGO_PORT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MONGO_INITDB_DATABASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uri)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// mongodb://admin:test123456@localhost:27017/auto-answer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mongoose.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uri, {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // authSource: &#39;admin&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;connect!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mongoose.connection</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">once</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;open&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;db is connect!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;error&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;close&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;db is closed!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mongoose</span></span></code></pre></div><h2 id="éªŒè¯" tabindex="-1">éªŒè¯ <a class="header-anchor" href="#éªŒè¯" aria-label="Permalink to &quot;éªŒè¯&quot;">â€‹</a></h2><p>å®Œæˆä¸Šé¢çš„æ­¥éª¤åŸºæœ¬ä¸Šå°±èƒ½é€šè¿‡ <code>compose</code> è¿è¡Œåç«¯çš„é¡¹ç›®äº†ï¼Œåœ¨é¡¹ç›®ç›®å½•é€šè¿‡å‘½ä»¤ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MACHINE_ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_INITDB_ROOT_PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_PASSWORD</span></span></code></pre></div><p>å°±ä¼šè¿è¡Œ <code>compose</code> ç”Ÿæˆä¸¤ä¸ªå®¹å™¨ï¼š</p><ul><li>auto-answer-backend-hubï¼šåç«¯æœåŠ¡</li><li>auto-answer-mongo-hubï¼šæ•°æ®åº“æœåŠ¡</li></ul><p>é€šè¿‡ <code>docker</code> å‘½ä»¤è¿›å…¥åˆ° <code>mongodb</code> å®¹å™¨ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auto-answer-mongo-hub</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/base</span></span></code></pre></div><p>è¿›å…¥åï¼Œè¾“å…¥ <code>mongo</code> è¿›å…¥ <code>mongo</code>ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mongo</span></span></code></pre></div><p>è¿™æ—¶å€™è¾“å…¥ <code>show dbs</code>ï¼Œå› ä¸ºæˆ‘ä»¬å¼€å¯äº†æ•°æ®åº“æƒé™æ˜¯çœ‹ä¸åˆ°æ•°æ®çš„</p><h3 id="éªŒè¯-root-ç”¨æˆ·" tabindex="-1">éªŒè¯ root ç”¨æˆ· <a class="header-anchor" href="#éªŒè¯-root-ç”¨æˆ·" aria-label="Permalink to &quot;éªŒè¯ root ç”¨æˆ·&quot;">â€‹</a></h3><ul><li>è¿›å…¥ <code>admin</code></li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> use admin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">switched</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin</span></span></code></pre></div><ul><li>ä½¿ç”¨ <code>db.auth</code></li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.auth(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;root&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_INITDB_ROOT_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>ä¸Šé¢çš„ <code>root</code> ä¸ºç¯å¢ƒæ–‡ä»¶ä¸­çš„ <code>MONGO_INITDB_ROOT_USERNAME</code>ï¼Œ<code>MONGO_INITDB_ROOT_PASSWORD</code> ä¸ºè¿è¡Œ <code>sh</code> è„šæœ¬æ˜¯æ³¨å…¥çš„å¯†ç ï¼ˆè¿™é‡Œéœ€è¦æ›´æ¢æˆè‡ªå·±çš„å¯†ç ï¼‰ã€‚</p><p>å¦‚æœå¯†ç è´¦å·å’Œå¯†ç æ­£ç¡®çš„è¯ä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.auth(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;root&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_INITDB_ROOT_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span></span></code></pre></div><p>è¿™æ—¶å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show dbs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">admin</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        0.000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auto-answer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  0.000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       0.000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        0.000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span></span></code></pre></div><h3 id="éªŒè¯å·¥ä½œåº“" tabindex="-1">éªŒè¯å·¥ä½œåº“ <a class="header-anchor" href="#éªŒè¯å·¥ä½œåº“" aria-label="Permalink to &quot;éªŒè¯å·¥ä½œåº“&quot;">â€‹</a></h3><p>æˆ‘ä»¬åœ¨<code>mongo-init.sh</code>ä¸­é€šè¿‡ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.createUser(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    user:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MONGO_USERNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    pwd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MONGO_PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    roles:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">role:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;readWrite&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$MONGO_INITDB_DATABASE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span></code></pre></div><p>ç”Ÿæˆäº†<code>MONGO_INITDB_DATABASE</code>ï¼Œè€Œè¿™é‡Œçš„<code>MONGO_INITDB_DATABASE</code>å°±æ˜¯æˆ‘ä»¬ç¯å¢ƒå˜é‡ä¸­è®¾ç½®çš„<code>auto-answer</code></p><p>ç„¶åæˆ‘ä»¬é€€å‡º <code>mongo</code> åé‡æ–°è¿›å…¥ <code>auto-answer</code>ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bye</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">root@a25acd1cd787:/#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mongo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MongoDB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v4.0.8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connecting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mongodb://127.0.0.1:27017/?gssapiServiceName=mongodb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Implicit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> session:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> session</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;id&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;1179501c-6e50-433b-90dc-db828be7c467&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MongoDB</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.8</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show dbs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> use auto-answer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">switched</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auto-answer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show collections</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Warning:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> unable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> listCollections,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> attempting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> approximate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> collection</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parsing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> connectionStatus</span></span></code></pre></div><p>è¿™æ—¶å¯ä»¥å‘ç° <code>auto-answer</code> ä¸‹æ²¡æœ‰ä»»ä½•è¡¨ï¼Œä¸‹ä¸€æ­¥è¿›è¡Œ <code>db.auth</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> db.auth(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MONGO_USERNAME,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MONGO_PASSWORD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show dbs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auto-answer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  0.000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> show collections</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">airs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cookers</span></span></code></pre></div><p>ä¸Šé¢çš„ <code>MONGO_USERNAME</code> æ˜¯ç¯å¢ƒå˜é‡ä¸­çš„ç”¨æˆ·åï¼ˆéœ€æ›¿æ¢æˆè‡ªå·±çš„ï¼‰ï¼Œ<code>MONGO_PASSWORD</code> æ˜¯é€šè¿‡ <code>sh</code> æ³¨å…¥çš„ç”Ÿæˆç”¨æˆ·çš„å¯†ç ã€‚</p><p>è‡³æ­¤å®Œæˆæ‰€æœ‰æ“ä½œã€‚</p>`,55),l=[p];function k(t,e,d,E,r,o){return a(),i("div",null,l)}const c=s(h,[["render",k]]);export{F as __pageData,c as default};
