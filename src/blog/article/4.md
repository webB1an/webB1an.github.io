# ä½¿ç”¨ Pnpm + Vite + Typescript æ­å»ºç»„ä»¶åº“

:::info åˆè¡·
æœ€è¿‘åœ¨çœ‹ element-plusã€vant è¿™ç±»é€‚é… vue3 çš„ç»„ä»¶åº“çš„æ—¶å€™ï¼Œå‘ç°è¿™äº›ç¬¬ä¸‰æ–¹çš„ç»„ä»¶åº“éƒ½åœ¨ç”¨ pnpm æ¥ç®¡ç†æ•´ä¸ªé¡¹ç›®ï¼Œè€Œæ°å·§ pnpm æ˜¯æˆ‘ä¹‹å‰æœªæ¥è§¦è¿‡çš„ï¼Œäºæ˜¯å°±æœ‰äº†æƒ³æ³•ä¸ºä½•ä¸åƒ element-plus ä¸€æ ·ç”¨ pnpm æ­å»ºä¸€å¥—å±äºè‡ªå·±çš„ç»„ä»¶åº“å‘¢ï¼Ÿ
:::

:::tip æç¤º
é¡¹ç›®ç»“æ„éƒ¨åˆ†ä»£ç å‚è€ƒ element-plus
:::

## å‚è€ƒ element-plus é¡¹ç›®ç»“æ„

```
element-plus
â”œâ”€ docs      # æ–‡æ¡£
â”œâ”€ packages  # å­åŒ…
â”œâ”€ internal  # æ„å»º
â””â”€ types     # ç±»å‹
â””â”€ package.json
```

åœ¨ç ”ç©¶ element é¡¹ç›®ä»£ç çš„æ—¶å€™å‘ç°ï¼Œelement æ˜¯å°†å¤šä¸ªé¡¹ç›®æ”¾åœ¨åŒä¸€ä¸ªæ¨¡å—ä¸‹å¼€å‘çš„ï¼Œè€Œå¦‚æœçœ‹è¿‡ vantã€vue3 ç­‰é¡¹ç›®ä¼šå‘ç°éƒ½æ˜¯ç”¨çš„ç±»ä¼¼çš„ç»“æ„ï¼Œç»è¿‡ä¸€ç•ªæŸ¥æ‰¾å‘ç°è¿™ç§é¡¹ç›®ç»“æ„å«åš Monorepoï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ Monorepo å‘¢ï¼Ÿ

## Monorepo

> Monorepo æ˜¯ä¸€ç§å°†å¤šä¸ªé¡¹ç›®å­˜æ”¾åœ¨åŒä¸€ä¸ªä»£ç åº“ä¸­çš„å¼€å‘ç­–ç•¥

elementã€vantã€vue3 ç­‰æˆ‘ä»¬ç†Ÿæ‚‰çš„é¡¹ç›®éƒ½æ˜¯åŸºäº Monorepo æ‰“é€ çš„ï¼Œç›®å‰æµè¡Œçš„ pnpm çš„ workspace å¯ä»¥æ”¯æŒ Monorepoã€‚

## é¡¹ç›®ç»“æ„

```
pnpm-ui
â”œâ”€ docs      # æ–‡æ¡£
â”œâ”€ packages  # å­åŒ…
â”œâ”€ internal  # æ„å»º
â””â”€ package.json
```

## Pnpm

### å®‰è£… pnpm

```sh
npm install pnpm -g
```

### åˆ›å»ºé¡¹ç›®ç›®å½•

```sh
mkdir pnpm-ui
```

### è¿›å…¥é¡¹ç›®

```sh
cd pnpm-ui
```

### åˆå§‹åŒ–é¡¹ç›®

è¯¥æ­¥éª¤ä¼šåœ¨ pnpm-ui æ ¹ç›®å½•ä¸‹ç”Ÿæˆ `package.json`

```sh
pnpm init
```

### åˆ›å»º pnpm-workspace.yaml

`pnpm-workspace.yaml`  æ˜¯å®šä¹‰äº†å·¥ä½œç©ºé—´çš„æ ¹ç›®å½•ï¼Œå¯ä»¥é€šè¿‡é€šé…ç¬¦æ¥åŒ…å«å’Œæ’é™¤ä¸éœ€è¦çš„ç›®å½•

```yaml
packages:
  - packages/*
  - docs
  - play
  - internal/*
```

### åˆ›å»º `.npmrc`

pnpm å¯ä»¥ä» `.npmrc` è·å–é…ç½®

```ini
shamefully-hoist=true
strict-peer-dependencies=false
shell-emulator=true
fetch-retries=5
fetch-retry-mintimeout=200000
fetch-retry-maxtimeout=1200000
fetch-timeout=1800000
registry=https://registry.npm.taobao.org
```

å¾ˆå¤šæ—¶å€™ç½‘ç»œåŸå› åŒ…ä¸‹è½½ä¸ä¸‹æ¥ï¼Œè¿™é‡Œçš„ `fetch-retries`ã€`fetch-retry-maxtimeout`ã€`fetch-timeout`ã€`registry` å¯ä»¥æ ¹æ®è‡ªå·±çš„ç½‘ç»œæƒ…å†µå†³å®šæ˜¯å¦é…ç½®ã€‚

## å®‰è£… vue

```sh
pnpm install vue -D -w
```

## é…ç½® typescript

### å®‰è£…

```
pnpm install typescript -D -w
```

### é…ç½®

åœ¨é˜…è¯» element-plus æºç çš„æ—¶å€™ï¼Œå‘ç° element å°† tsconfig æ ¹æ®é¡¹ç›®åˆ†æˆäº†å‡ ä¸ªéƒ¨åˆ†ï¼š

- `tsconfig.json`
- `tsconfig.base.json`
- `tsconfig.web.json`
- `tsconfig.play.json`
- `tsconfig.node.json`
- `tsconfig.vite-config.json`
- `tsconfig.vitest.json`

å æ—¶ç”¨ä¸åˆ° `tsconfig.vitest.json`ï¼Œæ‰€ä»¥åˆ é™¤ `tsconfig.vitest.json` å¹¶ä¸”ä¿ç•™å…¶ä»–é…ç½®ã€‚

äºæ˜¯ä¸‹é¢æ˜¯è¯¦ç»†çš„ä»£ç é…ç½®ï¼ˆå‡ ä¸ªæ–‡ä»¶éƒ½åœ¨æ ¹ç›®å½•ä¸‹ï¼‰ï¼š

::: details tsconfig.json
```json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.web.json" },
    { "path": "./tsconfig.play.json" },
    { "path": "./tsconfig.node.json" },
    { "path": "./tsconfig.vite-config.json" }
  ]
}
```
:::

::: details tsconfig.base.json
```json
{
  "compilerOptions": {
    "outDir": "dist",
    "target": "es2018",
    "module": "esnext",
    "baseUrl": ".",
    "sourceMap": false,
    "moduleResolution": "node",
    "allowJs": false,
    "strict": true,
    "noUnusedLocals": true,
    "resolveJsonModule": true,
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "removeComments": false,
    "rootDir": ".",
    "types": [],
    "paths": {
      "@pnpm-ui/*": ["packages/*"]
    }
  }
}

```
:::

::: details tsconfig.web.json
```json
{
  "extends": "./tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "jsx": "preserve",
    "lib": ["ES2018", "DOM", "DOM.Iterable"],
    "types": ["unplugin-vue-macros/macros-global"],
    "skipLibCheck": true
  },
  "include": ["packages", "typings/components.d.ts", "typings/env.d.ts"],
  "exclude": [
    "node_modules",
    "**/dist"
  ]
}

```
:::

::: details tsconfig.play.json
```json
{
  "extends": "./tsconfig.web.json",
  "compilerOptions": {
    "allowJs": true,
    "lib": ["ESNext", "DOM", "DOM.Iterable"]
  },
  "include": [
    "packages",
    "typings/components.d.ts",
    "typings/env.d.ts",

    // playground
    "play/main.ts",
    "play/env.d.ts",
    "play/src/**/*"
  ]
}

```
:::

::: details tsconfig.node.json
```json
{
  "extends": "./tsconfig.base.json",
  "compilerOptions": {
    "composite": true,
    "lib": ["ESNext"],
    "types": ["node"],
    "skipLibCheck": true
  },
  "include": [
    "internal/**/*",
    "internal/**/*.json",
  ],
  "exclude": []
}

```
:::

::: details tsconfig.vite-config.json
```json
{
  "extends": "./tsconfig.node.json",
  "compilerOptions": {
    "composite": true,
    "types": ["node"]
  },
  "include": ["**/vite.config.*", "**/vite.init.*"],
  "exclude": []
}

```
:::

### é”™è¯¯å¤„ç†

#### æ‰¾ä¸åˆ°â€œnodeâ€çš„ç±»å‹å®šä¹‰æ–‡ä»¶

é…ç½®å®Œä¸Šè¿°é…ç½®åä¼šå‘ç° `tsconfig.node.json` æŠ¥äº†ä»¥ä¸‹é”™è¯¯ï¼š

```
æ‰¾ä¸åˆ°â€œnodeâ€çš„ç±»å‹å®šä¹‰æ–‡ä»¶ã€‚
  ç¨‹åºåŒ…å«è¯¥æ–‡ä»¶æ˜¯å› ä¸º:
    åœ¨ compilerOptions ä¸­æŒ‡å®šçš„ç±»å‹åº“ "node" çš„å…¥å£ç‚¹
```

è¿™æ—¶å€™éœ€è¦å…¨å±€å®‰è£… `@types/node`

```sh
pnpm install @types/node -D -w
```

è¿™æ—¶å€™å°±ä¼šå‘ç°ä¸Šé¢çš„é—®é¢˜è§£å†³äº†~

#### includeã€exclude æŠ¥é”™

è¿™æ˜¯å› ä¸ºè¯»å–ä¸åˆ°ç›¸å…³çš„æ–‡ä»¶ï¼ŒæŠŠæŠ¥é”™çš„åœ°æ–¹æ³¨é‡Šæ‰å°±å¥½äº†~

## é…ç½® eslint + prettier

é…ç½® eslint å’Œ prettier æ˜¯ä¸ºäº†ç»Ÿä¸€ä»£ç çš„è´¨é‡é£æ ¼ï¼Œåœ¨é˜…è¯» element-plus é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç° element æŠŠ eslint ä¸»è¦è§„åˆ™æ”¾åœ¨æ ¹ç›®å½•çš„ internal æ–‡ä»¶ä¸‹ï¼Œè¿™ç§åšæ³•è®©æ•´ä¸ª eslint é…ç½®æ›´ç›´è§‚ä¸”æ˜“äºç»´æŠ¤ï¼Œå› æ­¤æˆ‘ä»¬å°±ç›´æ¥å‚ç…§ element å°±å¥½äº†ã€‚

### é¡¹ç›®å®‰è£… eslint + prettier

```sh
pnpm install eslint prettier -D -w
```

### é…ç½® eslint-config åŒ…

#### åˆ›å»º `eslint-config`

```sh
mkdir internal/eslint-config
```

#### init

ç„¶åå†å®šä½åˆ° `internal/eslint-config` æ–‡ä»¶ä¸‹æ‰§è¡Œ `pnpm init` ç”Ÿæˆ `package.json`ï¼š

```sh
pnpm init
```

æŠŠä¿®æ”¹ä¸‹ `internal/eslint-config` æ–‡ä»¶ä¸‹ `package.json` çš„åŒ…åæ”¹æˆ `@pnpm-ui/eslint-config`ï¼š

:::details package.json
```json
{
  "name": "@pnpm-ui/eslint-config",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}
```
:::

#### å®‰è£…åŒ…

åœ¨ `internal/eslint-config` æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```sh
pnpm install eslint prettier typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-config-prettier eslint-define-config eslint-plugin-eslint-comments eslint-plugin-import eslint-plugin-jsonc eslint-plugin-markdown eslint-plugin-prettier eslint-plugin-unicorn eslint-plugin-vue jsonc-eslint-parser yaml-eslint-parser -D -F @pnpm-ui/eslint-config
```

`pnpm install -F packagename` çš„ä½œç”¨æ˜¯åœ¨ packagename ä¸‹å®‰è£…åŒ…ï¼Œæ‰€æœ‰ä¸Šè¿°å‘½ä»¤çš„ä½œç”¨å°±æ˜¯åœ¨ `internal/eslint-config` ç›®å½•ä¸‹å®‰è£…ä¸Šé¢çš„è¿™äº›åŒ…ã€‚

ç®€å•æè¿°ä¸‹ä¸€äº›åŒ…çš„ä½œç”¨ï¼š

- eslint-define-configï¼šeslint è¯­æ³•æç¤º
- prettierã€eslint-config-prettierã€eslint-plugin-prettierï¼š å…¼å®¹ eslint é…ç½®ï¼Œé˜²æ­¢è§„åˆ™å†²çªæŠ¥é”™
- eslint-plugin-eslint-commentsï¼šç”¨æ¥æ£€æŸ¥eslint çš„ç‰¹æ®Šæ³¨è§£
- eslint-plugin-importï¼šè®© import å¯¼å…¥è‡ªåŠ¨æ’åºï¼Œè®©ä»£ç æ›´ç®€æ´ï¼Œæ›´åŠ æ¸…æ™°
- eslint-plugin-jsoncï¼šä¸º JSON, JSONC and JSON5 æä¾›éªŒè¯è§„åˆ™
- eslint-plugin-markdownï¼šä¸º markdown æä¾›è§„åˆ™
- eslint-plugin-unicornï¼šå†…ç½®å¾ˆå¤šæœ‰ç”¨çš„ eslint è§„åˆ™

#### åˆ›å»º eslint-config è§„åˆ™

:::details `internal/eslint-config/index.js`
```js
const { defineConfig } = require('eslint-define-config')

module.exports = defineConfig({
  env: {
    es6: true,
    browser: true,
    node: true,
  },
  plugins: ['@typescript-eslint', 'prettier', 'unicorn'],
  extends: [
    'eslint:recommended',
    'plugin:import/recommended',
    'plugin:eslint-comments/recommended',
    'plugin:jsonc/recommended-with-jsonc',
    'plugin:markdown/recommended',
    'plugin:vue/vue3-recommended',
    'plugin:@typescript-eslint/recommended',
    'prettier',
  ],
  settings: {
    'import/resolver': {
      node: { extensions: ['.js', '.mjs', '.ts', '.d.ts', '.tsx'] },
    },
  },
  overrides: [
    {
      files: ['*.json', '*.json5', '*.jsonc'],
      parser: 'jsonc-eslint-parser',
    },
    {
      files: ['*.ts', '*.vue'],
      rules: {
        'no-undef': 'off',
      },
    },
    {
      files: ['package.json'],
      parser: 'jsonc-eslint-parser',
      rules: {
        'jsonc/sort-keys': [
          'error',
          {
            pathPattern: '^$',
            order: [
              'name',
              'version',
              'private',
              'packageManager',
              'description',
              'type',
              'keywords',
              'homepage',
              'bugs',
              'license',
              'author',
              'contributors',
              'funding',
              'files',
              'main',
              'module',
              'exports',
              'unpkg',
              'jsdelivr',
              'browser',
              'bin',
              'man',
              'directories',
              'repository',
              'publishConfig',
              'scripts',
              'peerDependencies',
              'peerDependenciesMeta',
              'optionalDependencies',
              'dependencies',
              'devDependencies',
              'engines',
              'config',
              'overrides',
              'pnpm',
              'husky',
              'lint-staged',
              'eslintConfig',
            ],
          },
          {
            pathPattern: '^(?:dev|peer|optional|bundled)?[Dd]ependencies$',
            order: { type: 'asc' },
          },
        ],
      },
    },
    {
      files: ['*.d.ts'],
      rules: {
        'import/no-duplicates': 'off',
      },
    },
    {
      files: ['*.js'],
      rules: {
        '@typescript-eslint/no-var-requires': 'off',
      },
    },
    {
      files: ['*.vue'],
      parser: 'vue-eslint-parser',
      parserOptions: {
        parser: '@typescript-eslint/parser',
        extraFileExtensions: ['.vue'],
        ecmaVersion: 'latest',
        ecmaFeatures: {
          jsx: true,
        },
      },
      rules: {
        'no-undef': 'off',
      },
    },

    {
      files: ['**/*.md/*.js', '**/*.md/*.ts'],
      rules: {
        'no-console': 'off',
        'import/no-unresolved': 'off',
        '@typescript-eslint/no-unused-vars': 'off',
      },
    },
  ],
  rules: {
    // js/ts
    camelcase: ['error', { properties: 'never' }],
    'no-console': ['warn', { allow: ['error'] }],
    'no-debugger': 'warn',
    'no-constant-condition': ['error', { checkLoops: false }],
    'no-restricted-syntax': ['error', 'LabeledStatement', 'WithStatement'],
    'no-return-await': 'error',
    'no-var': 'error',
    'no-empty': ['error', { allowEmptyCatch: true }],
    'prefer-const': [
      'warn',
      { destructuring: 'all', ignoreReadBeforeAssign: true },
    ],
    'prefer-arrow-callback': [
      'error',
      { allowNamedFunctions: false, allowUnboundThis: true },
    ],
    'object-shorthand': [
      'error',
      'always',
      { ignoreConstructors: false, avoidQuotes: true },
    ],
    'prefer-rest-params': 'error',
    'prefer-spread': 'error',
    'prefer-template': 'error',

    'no-redeclare': 'off',
    '@typescript-eslint/no-redeclare': 'error',

    // best-practice
    'array-callback-return': 'error',
    'block-scoped-var': 'error',
    'no-alert': 'warn',
    'no-case-declarations': 'error',
    'no-multi-str': 'error',
    'no-with': 'error',
    'no-void': 'error',

    'sort-imports': [
      'warn',
      {
        ignoreCase: false,
        ignoreDeclarationSort: true,
        ignoreMemberSort: false,
        memberSyntaxSortOrder: ['none', 'all', 'multiple', 'single'],
        allowSeparatedGroups: false,
      },
    ],

    // stylistic-issues
    'prefer-exponentiation-operator': 'error',

    // ts
    '@typescript-eslint/explicit-module-boundary-types': 'off',
    '@typescript-eslint/no-explicit-any': 'off',
    '@typescript-eslint/no-non-null-assertion': 'off',
    '@typescript-eslint/no-non-null-asserted-optional-chain': 'off',
    '@typescript-eslint/consistent-type-imports': [
      'error',
      { disallowTypeAnnotations: false },
    ],
    '@typescript-eslint/ban-ts-comment': ['off', { 'ts-ignore': false }],

    // vue
    'vue/no-v-html': 'off',
    'vue/require-default-prop': 'off',
    'vue/require-explicit-emits': 'off',
    'vue/multi-word-component-names': 'off',
    'vue/prefer-import-from-vue': 'off',
    'vue/no-v-text-v-html-on-component': 'off',
    'vue/html-self-closing': [
      'error',
      {
        html: {
          void: 'always',
          normal: 'always',
          component: 'always',
        },
        svg: 'always',
        math: 'always',
      },
    ],

    // prettier
    'prettier/prettier': 'error',

    // import
    'import/first': 'error',
    'import/no-duplicates': 'error',
    'import/order': [
      'error',
      {
        groups: [
          'builtin',
          'external',
          'internal',
          'parent',
          'sibling',
          'index',
          'object',
          'type',
        ],

        pathGroups: [
          {
            pattern: 'vue',
            group: 'external',
            position: 'before',
          },
          {
            pattern: '@vue/**',
            group: 'external',
            position: 'before',
          },
          {
            pattern: '@w-ui/**',
            group: 'internal',
          },
        ],
        pathGroupsExcludedImportTypes: ['type'],
      },
    ],
    'import/no-unresolved': 'off',
    'import/namespace': 'off',
    'import/default': 'off',
    'import/no-named-as-default': 'off',
    'import/no-named-as-default-member': 'off',
    'import/named': 'off',

    // eslint-plugin-eslint-comments
    'eslint-comments/disable-enable-pair': ['error', { allowWholeFile: true }],
  },
})
```
:::

### å¼•å…¥ eslint-config

#### é¡¹ç›®æ ¹ç›®å½•å®‰è£… `@pnpm-ui/eslint-config`

é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œå‘½ä»¤

```sh
pnpm install @pnpm-ui/eslint-config -D -w
```

#### åˆ›å»º eslintrc

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `.eslintrc.json`

```sh
touch .eslintrc.json
```

`.eslintrc.json` å†…å®¹ä¸ºï¼š

```json
{
  "root": true,
  "extends": ["@pnpm-ui/eslint-config"]
}
```

### é…ç½® prettier

#### åˆ›å»º .prettierrc

```json
{
  "semi": false,
  "singleQuote": true,
  "overrides": [
    {
      "files": ".prettierrc",
      "options": {
        "parser": "json"
      }
    }
  ]
}
```

#### åˆ›å»º .prettierignore

```json
dist
node_modules
pnpm-lock.yaml
```

### é…ç½® settings

åˆ°è¿™é‡Œä½ ä¼šå‘ç°æˆ‘ä»¬å·²ç»é…ç½®äº† eslint å’Œ prettier ç›¸å…³çš„å†…å®¹ï¼Œä½†æ˜¯ä¿®æ”¹æ–‡ä»¶è¿˜æ˜¯ä¸ä¼šç”Ÿæ•ˆï¼

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰é…ç½®ç›¸å…³çš„è§„åˆ™è®©æˆ‘ä»¬åœ¨ä¿å­˜çš„æ—¶å€™ç”Ÿæ•ˆ

åœ¨æ ¹ç›®å½•åˆ›å»º `.vscode` æ–‡ä»¶å¤¹

```sh
mkdir .vscode
```

åœ¨ `.vscode` ä¸‹åˆ›å»º `settings.json`

```json
{
  "cSpell.words": ["Pnpm Ui", "pnpm-ui"],
  "typescript.tsdk": "node_modules/typescript/lib",
  "editor.formatOnSave": true,
  "npm.packageManager": "pnpm",
  "eslint.probe": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact",
    "html",
    "vue",
    "markdown",
    "json",
    "jsonc"
  ],
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact",
    "html",
    "vue",
    "markdown",
    "json",
    "jsonc"
  ],
  "vite.devCommand": "pnpm run dev -- --",
}
```

:::warning æ³¨æ„
æ³¨æ„è¿™é‡Œé…ç½®åéœ€è¦é‡å¯ä¸‹ç¼–è¾‘å™¨ï¼
:::

è¿™ä¸ªæ—¶å€™å‘ç°å½“ä¿®æ”¹é¡¹ç›®ä¸‹çš„æ–‡ä»¶åä¿å­˜ä¼šè‡ªåŠ¨æ ¼å¼åŒ–å•¦~

:::tip æé†’
ä»¥ä¸Šå°±æ˜¯ pnpm + monorepo åŸºæœ¬çš„é¡¹ç›®é…ç½®äº†ï¼Œä¸‹é¢æˆ‘ä»¬å¼€å§‹åˆ›å»º play æµ‹è¯•é¡¹ç›®å§ï¼
:::

## play

### å®‰è£…ç›¸å…³é…ç½®

é¦–å…ˆè¦åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º play æ–‡ä»¶å¤¹

```sh
mkdir play
```

ç„¶åè¿›å…¥ play

```sh
cd play
```

æ‰§è¡Œ `pnpm init` åˆ›å»º `package.json`

```sh
pnpm init
```

ä¿®æ”¹ paly ä¸‹ `package.json` åç§°ä¸ºï¼š`@pnpm-ui/play`

ç„¶åå®‰è£…ç›¸å…³åŒ…ï¼š

```sh
pnpm install vite @vitejs/plugin-vue unplugin-vue-components unplugin-vue-components unplugin-vue-macros -D -F @pnpm-ui/play
```

åœ¨ play ä¸‹çš„ `package.json` æ·»åŠ ç›¸å…³è¿è¡Œçš„ scriptsï¼š

```
"scripts": {
  "dev": "vite",
  "build": "vue-tsc && vite build",
  "preview": "vite preview"
}
```

### åˆ›å»º index.html

:::details /paly/index.html
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>W UI App</title>
    <!-- element css cdn -->
  </head>

  <body>
    <div id="play"></div>
    <script type="module" src="/main.ts"></script>
  </body>
</html>
```
:::

### åˆ›å»ºå…¥å£ vue æ–‡ä»¶

é¦–å…ˆåœ¨ /play æ–‡ä»¶å¤¹ä¸‹åˆ›å»º src æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨ src æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `App.vue` æ–‡ä»¶å’Œ `.gitignore` æ–‡ä»¶

```
mkdir /play/src
cd /play/src
touch App.vue
touch .gitignore
```

.gitignore å†…å®¹ï¼š

```
*
!.gitignore
```

è¡¨ç¤ºå¿½ç•¥ src æ–‡ä»¶å¤¹ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸åšæäº¤ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯æœ¬åœ°æµ‹è¯•ç”¨çš„

App.vue å†…å®¹ï¼š

```vue
<template>App</template>

<script lang="ts" setup></script>
```

æ¥ä¸‹æ¥åœ¨ /play åˆ›å»º `app.example.vue` æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š

```vue
<template>
  <div>app.example</div>
</template>

<script lang="ts" setup></script>
```

### åˆ›å»º main.ts

```ts
import { createApp } from 'vue'
;(async () => {
  const apps = import.meta.glob('./src/*.vue')
  const name = location.pathname.replace(/^\//, '') || 'App'
  const file = apps[`./src/${name}.vue`]
  if (!file) {
    location.pathname = 'App'
    return
  }
  const App = ((await file()) as unknown as any).default
  const app = createApp(App)

  app.mount('#play')
})()
```

è¿™æ—¶å€™ä½ ä¼šå‘ç° `import.meta.glob` è¯­æ³•çˆ†çº¢äº†ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ /play æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `env.d.ts` æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢å†…å®¹æ”¾è¿›å»å°±å¥½äº†ï¼š

```
/// <reference types="vite/client" />
```

æˆ–è€…åœ¨åœ¨ tsconfig ä¸­å¢åŠ ï¼š

```json
{
  "compilerOptions": {
    "types": ["vite/client"]
  }
}

```

### åˆ›å»º vite.init.ts

```ts
import { existsSync, readFileSync, writeFileSync } from 'fs'

const app = 'src/App.vue'
const example = 'app.example.vue'

if (!existsSync(app)) {
  writeFileSync(app, readFileSync(example))
}
```

### åˆ›å»º vite.config.ts

:::details /play/vite.config.ts
```ts
import { defineConfig, loadEnv } from 'vite'
import vue from '@vitejs/plugin-vue'
import Components from 'unplugin-vue-components/vite'
import VueMacros from 'unplugin-vue-macros/vite'

import './vite.init'

export default defineConfig(async ({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '')

  return {
    server: {
      host: true,
      https: !!env.HTTPS,
    },
    plugins: [
      VueMacros({
        setupComponent: false,
        setupSFC: false,
        plugins: {
          vue: vue(),
        },
      }),
      Components({
        dirs: `${__dirname}/../packages/components/**`,
        extensions: ['vue'],
        dts: false,
        resolvers: [
          (componentName) => {
            if (componentName.startsWith('P'))
              return { name: componentName, from: '@pnpm-ui/components' }
          },
        ],
      }),
    ],
    optimizeDeps: {
      include: ['vue', '@vue/shared'],
    },
    esbuild: {
      target: 'chrome64',
    },
  }
})
```
:::

### åœ¨æ ¹ç›®å½•ä¸‹ `package.json` æ·»åŠ  scripts

```json
"scripts": {
  "dev": "pnpm -C play dev",
}
```

### æµ‹è¯•è¿è¡Œ 

åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

```sh
pnpm dev
```

å¦‚æœæ²¡ä»€ä¹ˆé—®é¢˜çš„è¯ï¼Œé¡¹ç›®å°±æ­£å¸¸è·‘èµ·æ¥å•¦ï¼

:::tip æç¤º
é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»æŠŠæµ‹è¯•ç»„ä»¶çš„é¡¹ç›®æ­å»ºå®Œæˆï¼Œæ¥ä¸‹æ¥å°±è¦å¼€å§‹å¼€å‘æˆ‘ä»¬çš„ç»„ä»¶äº†ï¼
:::

## ç»„ä»¶æ­å»º

æˆ‘ä»¬é¦–å…ˆè¦åœ¨ /packages ç›®å½•ä¸‹åˆ›å»º components æ–‡ä»¶å¤¹ï¼Œåç»­çš„ ui ç»„ä»¶éƒ½ä¼šæ”¾åœ¨ components æ–‡ä»¶å¤¹ä¸‹ã€‚

```sh
mkdir packages/components
```

components å†…å®¹å¦‚ä¸‹ï¼š

```
/packages/components
â”œâ”€ button
  â”œâ”€src
    â”œâ”€button.vue
  â”œâ”€index.ts    
â”œâ”€ index.ts
â””â”€ package.json
```

### init

åœ¨ packages/components æ‰§è¡Œ pnpm init ç”Ÿæˆ `package.json`

```sh
pnpm init
```

ä¿®æ”¹ `package.json` çš„ nameï¼š

```json
{
  "name": "@pnpm-ui/components",
  "version": "0.0.1",
  "description": "all components are settled here",
  "main": "index.ts",
  "module": "index.ts",
  "unpkg": "index.js",
  "jsdelivr": "index.js",
  "types": "index.d.ts",
  "sideEffects": false
}
```

### åˆ›å»º button ç»„ä»¶

è¿™é‡Œåªåšç®€å•çš„æ¼”ç¤º

åœ¨ packages/components/ ä¸‹åˆ›å»º button æ–‡ä»¶å¤¹

```sh
mkdir packages/components/button
```

åœ¨ packages/components/button åˆ›å»º src æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ ç›¸å…³ç»„ä»¶ 

```sh
mkdir packages/components/button/src
```

åœ¨ packages/components/button/src åˆ›å»º button.vue æ–‡ä»¶

```sh
touch packages/components/button/src/button.vue
```

`button.vue` ä¸­å†…å®¹

```vue
<template>
  <div>this is button component</div>
</template>

<script lang="ts" setup>
defineOptions({
  name: 'PButton',
})
</script>
```

### å¯¼å‡º button

åœ¨ packages/components/button ä¸‹åˆ›å»º `index.ts`

```sh
touch packages/components/button/index.ts
```

packages/components/button/index.ts ä¸­å†…å®¹å¦‚ä¸‹ï¼š

```ts
import _button from './src/button.vue'

export const PButton = _button

export default PButton
```

åœ¨ packages/components ä¸‹åˆ›å»º `index.ts` å¼•å…¥ button

```sh
touch packages/components/index.ts
```

packages/components/index.ts å†…å®¹å¦‚ä¸‹

```ts
export * from './button'
```

### å®‰è£… @pnpm-ui/components

æ ¹ç›®å½•ä¸‹å®‰è£… `@pnpm-ui/components`

```sh
pnpm install @pnpm-ui/components -D -w
```

åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šä¸€ä¸ªç®€å•çš„ ui ç»„ä»¶å°±å·²ç»æ­å»ºå®Œæˆäº†ï¼Œä¸‹é¢æµ‹è¯•ä¸‹ç»„ä»¶ã€‚

## æµ‹è¯• PButton

ç°åœ¨æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸‹ `play/src/App.vue` çš„æ–‡ä»¶å†…å®¹ï¼Œå°† PButton å¼•å…¥ï¼Œä»£ç å¦‚ä¸‹

```vue
<template>
  App
  <p-button />
</template>

<script lang="ts" setup></script>
```

ç„¶ååœ¨æ ¹ç›®å½•è¿è¡Œï¼š

```sh
pnpm dev
```

ä¸å‡ºæ„å¤–çš„è¯ï¼Œæˆ‘ä»¬çš„æŒ‰é’®å°±å±•ç¤ºåˆ°é¡µé¢ä¸Šäº†ï¼

é‚£ä¹ˆæ¥ä¸‹æ¥å¼€å§‹åšè§„èŒƒåŒ–æäº¤ç›¸å…³çš„é…ç½®å•¦ï¼

## è§„èŒƒåŒ– commit message

### åˆå§‹åŒ– git

æ ¹ç›®å½•è¿è¡Œ

```sh
git init
```

### å®‰è£…ç›¸å…³åŒ…

é¡¹ç›®æ ¹ç›®å½•å®‰è£…ï¼š

```sh
pnpm install @commitlint/cli @commitlint/config-conventional cz-git czg husky lint-staged @esbuild-kit/cjs-loader fast-glob -D -w
```

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `commitlint.config.js` å’Œ `commitlint.config.ts`

`commitlint.config.js` å†…å®¹å¦‚ä¸‹ï¼š

```js
require('@esbuild-kit/cjs-loader')
module.exports = require('./commitlint.config.ts').default
```

`commitlint.config.ts` å†…å®¹å¦‚ä¸‹ï¼š

:::details commitlint.config.ts
```ts
import { execSync } from 'child_process'
import fg from 'fast-glob'

const getPackages = (packagePath: string) =>
  fg.sync('*', { cwd: packagePath, onlyDirectories: true })

const scopes = [
  ...getPackages('packages'),
  ...getPackages('internal'),
  'docs',
  'play',
  'project',
  'core',
  'style',
  'ci',
  'dev',
  'deploy',
  'other',
  'typography',
  'color',
  'border',
  'var',
  'ssr',
]

const gitStatus = execSync('git status --porcelain || true')
  .toString()
  .trim()
  .split('\n')

const scopeComplete = gitStatus
  .find((r) => ~r.indexOf('M  packages'))
  ?.replace(/\//g, '%%')
  ?.match(/packages%%((\w|-)*)/)?.[1]

const subjectComplete = gitStatus
  .find((r) => ~r.indexOf('M  packages/components'))
  ?.replace(/\//g, '%%')
  ?.match(/packages%%components%%((\w|-)*)/)?.[1]

export default {
  rules: {
    /**
     * type[scope]: [function] description
     *      ^^^^^
     */
    'scope-enum': [2, 'always', scopes],
    /**
     * type[scope]: [function] description
     *
     * ^^^^^^^^^^^^^^ empty line.
     * - Something here
     */
    'body-leading-blank': [1, 'always'],
    /**
     * type[scope]: [function] description
     *
     * - something here
     *
     * ^^^^^^^^^^^^^^
     */
    'footer-leading-blank': [1, 'always'],
    /**
     * type[scope]: [function] description [No more than 72 characters]
     *      ^^^^^
     */
    'header-max-length': [2, 'always', 72],
    'scope-case': [2, 'always', 'lower-case'],
    'subject-case': [
      1,
      'never',
      ['sentence-case', 'start-case', 'pascal-case', 'upper-case'],
    ],
    'subject-empty': [2, 'never'],
    'subject-full-stop': [2, 'never', '.'],
    'type-case': [2, 'always', 'lower-case'],
    'type-empty': [2, 'never'],
    /**
     * type[scope]: [function] description
     * ^^^^
     */
    'type-enum': [
      2,
      'always',
      [
        'build',
        'chore',
        'ci',
        'docs',
        'feat',
        'fix',
        'perf',
        'refactor',
        'revert',
        'release',
        'style',
        'test',
        'improvement',
      ],
    ],
  },
  prompt: {
    defaultScope: scopeComplete,
    customScopesAlign: !scopeComplete ? 'top' : 'bottom',
    defaultSubject: subjectComplete && `[${subjectComplete}] `,
    allowCustomIssuePrefixs: false,
    allowEmptyIssuePrefixs: false,
  },
}
```
:::

### ä¿®æ”¹ `package.json`

```json
"scripts": {
  "cz": "czg",
},
"config": {
  "commitizen": {
    "path": "./node_modules/cz-git"
  }
},
"lint-staged": {
  "*.{vue,js,ts,jsx,tsx,md,json}": "eslint --fix"
}
```

### é…ç½® husky

æ‰§è¡Œ init

```sh
npx husky-init
```

æ·»åŠ  hooks

```sh
npx husky add .husky/commit-msg 'pnpm exec commitlint --config commitlint.config.js --edit "${1}"'
```

è¿™æ—¶å€™ä¼šå‘ç°é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºäº† .husky æ–‡ä»¶å¤¹ï¼Œ.husky ç»“æ„å¦‚ä¸‹ï¼š

```
ğŸ“¦.husky
 â”£ ğŸ“‚_
 â”ƒ â”£ ğŸ“œ.gitignore
 â”ƒ â”— ğŸ“œhusky.sh
 â”£ ğŸ“œcommit-msg
 â”— ğŸ“œpre-commit
```

commit-msg å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š

```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

pnpm exec commitlint --config commitlint.config.js --edit "${1}"
```

pre-commit å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š

```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

pnpm exec lint-staged
```

## .gitignore

```
# Editor directories and files
.idea

# Package Manager
node_modules
.pnpm-debug.log*

# System
.DS_Store

# Bundle
dist

# local env files
*.local
.eslintcache
```

åˆ°æ­¤é¡¹ç›®çš„è§„èŒƒåŒ– commit å°±å®Œæˆå•¦ï¼

## æ€»ç»“

é™¤äº†ç»„ä»¶åº“çš„é¡¹ç›®æ–‡æ¡£å¤–ï¼ŒåŸºæœ¬ä¸Šåˆ°è¿™é‡Œå°±å®Œæˆäº† pnpm + monorepo çš„ ui ç»„ä»¶åº“çš„é¡¹ç›®æ­å»ºäº†ï¼

åé¢æœ‰æ—¶é—´æŠŠæ–‡æ¡£æ­å»ºä¹ŸåŠ ä¸Š~