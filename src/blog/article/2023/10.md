# Vue3+Vite+Ts é¡¹ç›®æ­å»º

è¿™æ¬¡çš„é¡¹ç›®æ­å»ºå°†ä¼šåœ¨é¡¹ç›®ä¸­é›†æˆä¸€ä¸‹åŠŸèƒ½ï¼š

- eslint ä»£ç è§„èŒƒ
- alias å¼€å‘è·¯å¾„åˆ«å
- unplugin-auto-import æŒ‰éœ€å¯¼å…¥ API
- unplugin-vue-components è‡ªåŠ¨å¯¼å…¥ç»„ä»¶
- unocss æ ·å¼åº“
- ä»£ç  commit è§„èŒƒ
- unplugin-vue-macros

ç›¸è¾ƒäºä¹‹å‰çš„ [simple-vite-template-v2](https://github.com/webB1an/simple-vite-template-v2) é¡¹ç›®æ¨¡æ¿ï¼Œæœ¬æ¬¡çš„é¡¹ç›®æ­å»ºç§»é™¤äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

- markdown è½¬æ¢ä¸º vue ç»„ä»¶çš„åŠŸèƒ½
- @unocss/preset-icons ä½¿ç”¨

å¦‚æœéœ€è¦ä½¿ç”¨ä»¥ä¸ŠåŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒ [simple-vite-template-v2](https://github.com/webB1an/simple-vite-template-v2)ã€‚

## é¡¹ç›®åˆå§‹åŒ–

```bash
# åˆ›å»ºé¡¹ç›®
pnpm create vite vite-vue3-ts-template --template vue-ts
# è¿›å…¥é¡¹ç›®
cd vite-vue3-ts-template
```

### é…ç½® pnmp

åˆ›å»º .npmrc

```bash
touch .npmrc
```

pnpm å¯ä»¥ä» .npmrc è·å–é…ç½®

```ini
shamefully-hoist=true
strict-peer-dependencies=false
shell-emulator=true
fetch-retries=5
fetch-retry-mintimeout=200000
fetch-retry-maxtimeout=1200000
fetch-timeout=1800000
registry=https://registry.npm.taobao.org
```

å¾ˆå¤šæ—¶å€™ç½‘ç»œåŸå› åŒ…ä¸‹è½½ä¸ä¸‹æ¥ï¼Œè¿™é‡Œçš„ fetch-retriesã€fetch-retry-maxtimeoutã€fetch-timeoutã€registry å¯ä»¥æ ¹æ®è‡ªå·±çš„ç½‘ç»œæƒ…å†µå†³å®šæ˜¯å¦é…ç½®ã€‚

```bash
# å®‰è£…ä¾èµ–
pnpm install
# å¯åŠ¨é¡¹ç›®
pnpm run dev
```

## é…ç½® eslint

### å®‰è£…ä¾èµ–

```bash
pnpm add -D eslint @antfu/eslint-config
```

### é…ç½® eslint

åœ¨é¡¹ç›®ä¸‹åˆ›å»º `.eslintrc` æ–‡ä»¶

```bash
touch .eslintrc
```

`.eslintrc` å†…å®¹å¦‚ä¸‹

```json
{
  "extends": "@antfu"
}
```

åœ¨ `package.json` åŠ å…¥å¦‚ä¸‹ script

```json
{
  "scripts": {
    "lint": "eslint .",
    "lint:fix": "eslint . --fix"
  }
}
```

### é…ç½® vscode

å®‰è£… [eslint æ‰©å±•](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)

æ·»åŠ å¦‚ä¸‹é…ç½®åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `.vscode/settings.json` æ–‡ä»¶

```json
{
  "prettier.enable": false,
  "editor.formatOnSave": false,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.organizeImports": false
  },

  // The following is optional.
  // It's better to put under project setting `.vscode/settings.json`
  // to avoid conflicts with working with different eslint configs
  // that does not support all formats.
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact",
    "vue",
    "html",
    "markdown",
    "json",
    "jsonc",
    "yaml"
  ]
}
``` 

## é…ç½® alias

åœ¨ `vite.config.ts` ä¸­é…ç½® aliasï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç 

```js
import path from 'node:path' // [!code ++]
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

// https://vitejs.dev/config/
export default defineConfig({
  base: './',  // [!code ++]
  plugins: [vue()],
  resolve: {  // [!code ++]
    alias: {  // [!code ++]
      '@': path.resolve(__dirname, './src'),  // [!code ++]
    },  // [!code ++]
  },  // [!code ++]
})
```

é…ç½®å¦‚ä¸Šä»£ç åä¼šå‘ç°æ‰¾ä¸åˆ°æ¨¡å—â€œnode:pathâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜å’Œæ‰¾ä¸åˆ°åç§°â€œ__dirnameâ€ã€‚è¿™æ˜¯å› ä¸º vite æ˜¯åŸºäº esm çš„ï¼Œæ‰€ä»¥éœ€è¦å®‰è£… `@types/node`ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç 

```bash
pnpm add -D @types/node
```

ç„¶åå…³é—­é¡µé¢é‡å†™æ‰“å¼€ï¼Œå°±å¯ä»¥æ­£å¸¸äº†ã€‚ï¼ˆå¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œå¯ä»¥å°è¯•é‡å¯ç¼–è¾‘å™¨ï¼‰

## é…ç½® unplugin-auto-import

è¯¦ç»†é…ç½®è¯·å‚è€ƒ [unplugin-auto-import](https://github.com/unplugin/unplugin-auto-import)

unplugin-auto-import å¯ä»¥ä¸º vite æŒ‰éœ€å¯¼å…¥ APIï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä»£ç å¦‚ä¸‹ï¼š

```js
import { computed, ref } from 'vue'

const count = ref(0)
const doubled = computed(() => count.value * 2)
```

ä½¿ç”¨ unplugin-auto-import åï¼Œå¯ä»¥è¿™æ ·å†™ï¼š

```js
const count = ref(0)
const doubled = computed(() => count.value * 2)
```

### å®‰è£…ä¾èµ–

```bash
pnpm add -D unplugin-auto-import
```

åœ¨ `vite.config.ts` ä¸­é…ç½® unplugin-auto-importï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç 

```js
import path from 'node:path'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import AutoImport from 'unplugin-auto-import/vite'

// https://vitejs.dev/config/
export default defineConfig({
  base: './',
  plugins: [
    vue(),
    // https://github.com/unplugin/unplugin-auto-import
    AutoImport({
      imports: [
        // é¢„è®¾
        'vue',
        // 'vue-router',
        // 'vuex',

        // è‡ªå®šä¹‰
        {
          '@vueuse/core': [
            'useMouse', // import { useMouse } from '@vueuse/core',
            // alias
            ['useFetch', 'useMyFetch'], // import { useFetch as useMyFetch } from '@vueuse/core',
          ],
        },
      ],
      dts: 'types/auto-imports.d.ts',
      // è‡ªåŠ¨å¯¼å…¥ç›®å½•ä¸‹çš„æ¨¡å—å¯¼å‡º
      // é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåªä¼šæ‰«æç›®å½•ä¸‹çš„ä¸€ä¸ªçº§åˆ«çš„æ¨¡å—
      dirs: [
        // './hooks',
        // './composables' // åªæœ‰æ ¹æ¨¡å—
        // './composables/**', // æ‰€æœ‰åµŒå¥—æ¨¡å—
        // ...
      ],
    }),
  ],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

è¿™æ˜¯ä½ å¦‚æœåœ¨ vue æ–‡ä»¶ä¸­æµ‹è¯•å¦‚ä¸‹ä»£ç 

```vue
<script setup lang="ts">
const msg = ref(666)
</script>

<template>
  {{ msg }}
</template>
```

ä½ ä¼šå‘ç°æŠ¥äº†æ‰¾ä¸åˆ°åç§°â€œrefâ€çš„é”™è¯¯ï¼Œè¿™æ—¶å€™éœ€è¦åœ¨ `tsconfig.json` åŠ å…¥å¦‚ä¸‹ä»£ç 

```json
{
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue", "types/**/*.d.ts"]
}
```

è¿™æ—¶å€™ä½ ä¼šå‘ç°æŠ¥äº†æ‰¾ä¸åˆ°åç§°â€œrefâ€çš„é”™è¯¯æ²¡æœ‰äº†~

## é…ç½® unplugin-vue-components

è¯¦ç»†é…ç½®è¯·å‚è€ƒ [unplugin-vue-components](https://github.com/unplugin/unplugin-vue-components)

### å®‰è£…ä¾èµ–

```bash
pnpm add -D unplugin-vue-components
```

åœ¨ `vite.config.ts` ä¸­é…ç½® unplugin-vue-componentsï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç 

```js
import path from 'node:path'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'

// https://vitejs.dev/config/
export default defineConfig({
  base: './',
  plugins: [
    vue(),
    // https://github.com/unplugin/unplugin-auto-import
    AutoImport({
      imports: [
        // é¢„è®¾
        'vue',
        // 'vue-router',
        // 'vuex',

        // è‡ªå®šä¹‰
        {
          '@vueuse/core': [
            'useMouse', // import { useMouse } from '@vueuse/core',
            // alias
            ['useFetch', 'useMyFetch'], // import { useFetch as useMyFetch } from '@vueuse/core',
          ],
        },
      ],
      dts: 'types/auto-imports.d.ts',
      // è‡ªåŠ¨å¯¼å…¥ç›®å½•ä¸‹çš„æ¨¡å—å¯¼å‡º
      // é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåªä¼šæ‰«æç›®å½•ä¸‹çš„ä¸€ä¸ªçº§åˆ«çš„æ¨¡å—
      dirs: [
        // './hooks',
        // './composables' // åªæœ‰æ ¹æ¨¡å—
        // './composables/**', // æ‰€æœ‰åµŒå¥—æ¨¡å—
        // ...
      ],
    }),
    // https://github.com/unplugin/unplugin-vue-components
    Components({
      // å…è®¸è‡ªåŠ¨å¯¼å…¥
      include: [/\.vue$/, /\.vue\?vue/],
      dts: 'types/components.d.ts',
    }),
  ],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

è¿™æ—¶å€™å¦‚æœåˆ é™¤ App.vue ä¸­å¼•å…¥çš„ç»„ä»¶ï¼Œä¼šå‘ç°åœ¨æœªå¼•å…¥ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œè¿™æ˜¯å› ä¸º unplugin-vue-components ä¼šè‡ªåŠ¨å¯¼å…¥ç»„ä»¶

```vue
<script setup lang="ts">
import HelloWorld from './components/HelloWorld.vue' // [!code --]
</script>
```

## è§„èŒƒåŒ–é¡¹ç›® commit

### åˆå§‹åŒ– git

```bash
git init
```

### å®‰è£…ç›¸å…³ä¾èµ–

```bash
pnpm install @commitlint/cli @commitlint/config-conventional cz-git czg husky lint-staged @esbuild-kit/cjs-loader -D
```

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `commitlint.config.cjs` å’Œ `commitlint.config.ts`

commitlint.config.cjs å†…å®¹å¦‚ä¸‹ï¼š

```js
module.exports = require('./commitlint.config.ts').default
```

commitlint.config.ts å†…å®¹å¦‚ä¸‹ï¼š

```ts
import { execSync } from 'node:child_process'

const scopes = [
  'views',
  'components',
  'router',
  'store',
  'utils',
  'styles',
  'assets',
  'types',
  'other',
]

const gitStatus = execSync('git status --porcelain || true')
  .toString()
  .trim()
  .split('\n')

const scopeComplete = gitStatus
  .find(r => ~r.indexOf('M  src'))
  ?.replace(/(\/)/g, '%%')
  ?.match(/src%%((\w|-)*)/)?.[1];

const subjectComplete = gitStatus
  .find(r => ~r.indexOf('M  src'))
  ?.replace(/\//g, '%%')
   ?.match(/src%%((\w|-)*)/)?.[1];

export default {
  rules: {
    /**
     * type[scope]: [function] description
     *      ^^^^^
     */
    'scope-enum': [2, 'always', scopes],
    /**
     * type[scope]: [function] description
     *
     * ^^^^^^^^^^^^^^ empty line.
     * - Something here
     */
    'body-leading-blank': [1, 'always'],
    /**
     * type[scope]: [function] description
     *
     * - something here
     *
     * ^^^^^^^^^^^^^^
     */
    'footer-leading-blank': [1, 'always'],
    /**
     * type[scope]: [function] description [No more than 72 characters]
     *      ^^^^^
     */
    'header-max-length': [2, 'always', 72],
    'scope-case': [2, 'always', 'lower-case'],
    'subject-case': [
      1,
      'never',
      ['sentence-case', 'start-case', 'pascal-case', 'upper-case'],
    ],
    'subject-empty': [2, 'never'],
    'subject-full-stop': [2, 'never', '.'],
    'type-case': [2, 'always', 'lower-case'],
    'type-empty': [2, 'never'],
    /**
     * type[scope]: [function] description
     * ^^^^
     */
    'type-enum': [
      2,
      'always',
      [
        'build',
        'chore',
        'ci',
        'docs',
        'feat',
        'fix',
        'perf',
        'refactor',
        'revert',
        'release',
        'style',
        'test',
        'improvement',
      ],
    ],
  },
  prompt: {
    defaultScope: scopeComplete,
    customScopesAlign: !scopeComplete ? 'top' : 'bottom',
    defaultSubject: subjectComplete && `[${subjectComplete}] `,
    allowCustomIssuePrefixs: false,
    allowEmptyIssuePrefixs: false,
  },
}
```

### ä¿®æ”¹ package.json

```json
{
  "scripts": {
    "cz": "czg",
  },
  "config": {
    "commitizen": {
      "path": "./node_modules/cz-git"
    }
  },
  "lint-staged": {
    "*.{vue,js,ts,jsx,tsx,md,json}": "eslint --fix"
  }
}
```

### é…ç½® husky

æ‰§è¡Œ init

```bash
npx husky-init
```

æ·»åŠ  hooks

```bash
npx husky add .husky/commit-msg 'pnpm exec commitlint --config commitlint.config.cjs --edit "${1}"'
```

è¿™æ—¶å€™ä¼šå‘ç°é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºäº† .husky æ–‡ä»¶å¤¹ï¼Œ.husky ç»“æ„å¦‚ä¸‹ï¼š

```
ğŸ“¦.husky
 â”£ ğŸ“‚_
 â”ƒ â”£ ğŸ“œ.gitignore
 â”ƒ â”— ğŸ“œhusky.sh
 â”£ ğŸ“œcommit-msg
 â”— ğŸ“œpre-commit
```

commit-msg å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š

```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

pnpm exec commitlint --config commitlint.config.cjs --edit "${1}"
```

pre-commit å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š

```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

pnpm exec lint-staged
```

## é…ç½® unocss

### å®‰è£…ä¾èµ–

```bash
pnpm add -D unocss
```

### é…ç½® vite.config.ts

```js
// vite.config.ts
import UnoCSS from 'unocss/vite'
import { defineConfig } from 'vite'

export default defineConfig({
  plugins: [
    UnoCSS(),
  ],
})
```

### é…ç½® uno.config.ts

```ts
import {
  defineConfig,
  presetAttributify,
  presetIcons,
  presetTypography,
  presetUno,
  presetWebFonts,
  transformerDirectives,
  transformerVariantGroup,
} from 'unocss'

export default defineConfig({
  shortcuts: [
  ],
  presets: [
    presetUno(),
    presetAttributify(),
    presetIcons({
      scale: 1.2,
      warn: true,
    }),
    presetTypography(),
    presetWebFonts({
      fonts: {
        sans: 'DM Sans',
        serif: 'DM Serif Display',
        mono: 'DM Mono',
      },
    }),
  ],
  transformers: [
    transformerDirectives(),
    transformerVariantGroup(),
  ],
  safelist: 'prose prose-sm m-auto text-left'.split(' '),
})
```

### å¼•å…¥æ ·å¼

```ts
import { createApp } from 'vue'
import './style.css'
import App from './App.vue'

import '@unocss/reset/tailwind.css' // [!code ++]
import 'uno.css' // [!code ++]

createApp(App).mount('#app')
```

### é…ç½® eslint

å®‰è£… `@unocss/eslint-config`

è¿™é‡Œé…ç½®çš„ eslint æ˜¯ä¸ºäº†ä»£ç é¡ºåºæ›´åŠ ç¾è§‚ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥ä¸é…ç½®

```bash
pnpm add -D @unocss/eslint-config
```

åœ¨ `.eslintrc` ä¸­åŠ å…¥ï¼š

```json
{
  "extends": [
    "@antfu",
    "@unocss"
  ],
  "rules": {
    "@unocss/order": "error",
    "@unocss/order-attributify": "error"
  }
}
```

### å®‰è£… unocss æ‰©å±•

[antfu.unocss](https://marketplace.visualstudio.com/items?itemName=antfu.unocss)

:::danger æ³¨æ„
è¿™æ—¶å€™å¦‚æœåœ¨ä»£ç ä¸­å†™æ ·å¼æ²¡æœ‰æç¤ºçš„è¯ï¼Œè¯·æŠŠ `.vscode/settings.json` ä¸­çš„ `editor.quickSuggestions` è®¾ç½®ä¸‹

```json
{
  "editor.quickSuggestions": {
    "strings": "on"
  }
}
```

ä¸Šé¢é…ç½®å¥½åï¼Œå¦‚æœå†™ unocss çš„æ ·å¼ vscode è¿˜æ˜¯æ²¡æœ‰æç¤ºçš„è¯ï¼Œè¯·é‡å¯ç¼–è¾‘å™¨ï¼ï¼ï¼
:::

## é…ç½® unplugin-vue-macros

### å®‰è£…ä¾èµ–

```bash
pnpm add -D unplugin-vue-macros
```

### é…ç½® vite.config.ts

```ts
import path from 'node:path'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import VueMacros from 'unplugin-vue-macros/vite' // [!code ++]

import UnoCSS from 'unocss/vite'

// https://vitejs.dev/config/
export default defineConfig({
  base: './',
  plugins: [
    // vue(), // [!code --]
    VueMacros({ // [!code ++]
      plugins: { // [!code ++]
        vue: vue(), // [!code ++]
      }, // [!code ++]
    }), // [!code ++]
    // https://github.com/unplugin/unplugin-auto-import
    AutoImport({
      imports: [
        // é¢„è®¾
        'vue',
        // 'vue-router',
        // 'vuex',

        // è‡ªå®šä¹‰
        {
          '@vueuse/core': [
            'useMouse', // import { useMouse } from '@vueuse/core',
            // alias
            ['useFetch', 'useMyFetch'], // import { useFetch as useMyFetch } from '@vueuse/core',
          ],
        },
      ],
      dts: 'types/auto-imports.d.ts',
      // è‡ªåŠ¨å¯¼å…¥ç›®å½•ä¸‹çš„æ¨¡å—å¯¼å‡º
      // é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåªä¼šæ‰«æç›®å½•ä¸‹çš„ä¸€ä¸ªçº§åˆ«çš„æ¨¡å—
      dirs: [
        // './hooks',
        // './composables' // åªæœ‰æ ¹æ¨¡å—
        // './composables/**', // æ‰€æœ‰åµŒå¥—æ¨¡å—
        // ...
      ],
    }),
    // https://github.com/unplugin/unplugin-vue-components
    Components({
      // å…è®¸è‡ªåŠ¨å¯¼å…¥
      include: [/\.vue$/, /\.vue\?vue/],
      dts: 'types/components.d.ts',
    }),

    UnoCSS(),
  ],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

### æ·»åŠ  ts æ”¯æŒ

`tsconfig.json` ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š

```json
// tsconfig.json
{
  "compilerOptions": {
    // ...
    "types": ["unplugin-vue-macros/macros-global" /* ... */]
  }
}
```

### æ·»åŠ  Volar æ”¯æŒ

```bash
pnpm add -D @vue-macros/volar
```

`tsconfig.json` ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š

```json
// tsconfig.json
{
  "vueCompilerOptions": {
    "plugins": [
      "@vue-macros/volar/define-options",
      "@vue-macros/volar/define-models",
      "@vue-macros/volar/define-props",
      "@vue-macros/volar/define-props-refs",
      "@vue-macros/volar/short-vmodel",
      "@vue-macros/volar/define-slots",
      "@vue-macros/volar/jsx-directive"
    ]
  }
}
```

## ä¿®æ”¹ .vscode/extensions.json

```json
{
  "recommendations": [
    "Vue.volar",
    "Vue.vscode-typescript-vue-plugin",
    "antfu.iconify",
    "antfu.unocss",
    "antfu.vite",
    "antfu.goto-alias",
    "csstools.postcss",
    "dbaeumer.vscode-eslint",
    "streetsidesoftware.code-spell-checker"
  ]
}
```

ä¿®æ”¹å vscode ä¼šè‡ªåŠ¨å®‰è£…è¿™äº›æ’ä»¶ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥åˆ é™¤ã€‚

## æ€»ç»“

è‡³æ­¤ï¼Œä¸€ä¸ªåŸºäº Vue3+Vite+Ts çš„é¡¹ç›®æ­å»ºå®Œæˆï¼

é¡¹ç›®é›†æˆäº†ä»¥ä¸‹åŠŸèƒ½ï¼š

- eslint ä»£ç è§„èŒƒ
- alias å¼€å‘è·¯å¾„åˆ«å
- unplugin-auto-import æŒ‰éœ€å¯¼å…¥ API
- unplugin-vue-components è‡ªåŠ¨å¯¼å…¥ç»„ä»¶
- unocss æ ·å¼åº“
- ä»£ç  commit è§„èŒƒ
